{"version":3,"sources":["upload-compiled.js"],"names":[],"mappings":"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","file":"upload-compiled-compiled.js","sourcesContent":["/*!\n\n @Title: layui.upload 单文件上传 - 全浏览器兼容版\n @Author: 贤心\n @License：LGPL\n\n */\n\nlayui.define('layer', function (exports) {\n  \"use strict\";\n\n  var $ = layui.jquery;\n  var layer = layui.layer;\n  var device = layui.device();\n\n  var elemDragEnter = 'layui-upload-enter';\n  var elemIframe = 'layui-upload-iframe';\n\n  var msgConf = {\n    icon: 2,\n    shift: 6\n  },\n      fileType = {\n    file: '文件',\n    video: '视频',\n    audio: '音频'\n  };\n\n  var Upload = function (options) {\n    this.options = options;\n  };\n\n  //初始化渲染\n  Upload.prototype.init = function () {\n    var that = this,\n        options = that.options;\n    var body = $('body'),\n        elem = $(options.elem || '.layui-upload-file');\n    var iframe = $('<iframe id=\"' + elemIframe + '\" class=\"' + elemIframe + '\" name=\"' + elemIframe + '\"></iframe>');\n\n    //插入iframe    \n    $('#' + elemIframe)[0] || body.append(iframe);\n\n    return elem.each(function (index, item) {\n      item = $(item);\n      var form = '<form target=\"' + elemIframe + '\" method=\"' + (options.method || 'post') + '\" key=\"set-mine\" enctype=\"multipart/form-data\" action=\"' + (options.url || '') + '\"></form>';\n\n      var type = item.attr('lay-type') || options.type; //获取文件类型\n\n      //包裹ui元素\n      if (!options.unwrap) {\n        form = '<div class=\"layui-box layui-upload-button\">' + form + '<span class=\"layui-upload-icon\"><i class=\"layui-icon\">&#xe608;</i>' + (item.attr('lay-title') || options.title || '上传' + (fileType[type] || '图片')) + '</span></div>';\n      }\n\n      form = $(form);\n\n      //拖拽支持\n      if (!options.unwrap) {\n        form.on('dragover', function (e) {\n          e.preventDefault();\n          $(this).addClass(elemDragEnter);\n        }).on('dragleave', function () {\n          $(this).removeClass(elemDragEnter);\n        }).on('drop', function () {\n          $(this).removeClass(elemDragEnter);\n        });\n      }\n\n      //如果已经实例化，则移除包裹元素\n      if (item.parent('form').attr('target') === elemIframe) {\n        if (options.unwrap) {\n          item.unwrap();\n        } else {\n          item.parent().next().remove();\n          item.unwrap().unwrap();\n        }\n      };\n\n      //包裹元素\n      item.wrap(form);\n\n      //触发上传\n      item.off('change').on('change', function () {\n        that.action(this, type);\n      });\n    });\n  };\n\n  //提交上传\n  Upload.prototype.action = function (input, type) {\n    var that = this,\n        options = that.options,\n        val = input.value;\n    var item = $(input),\n        ext = item.attr('lay-ext') || options.ext || ''; //获取支持上传的文件扩展名;\n\n    if (!val) {\n      return;\n    };\n\n    //校验文件\n    switch (type) {\n      case 'file':\n        //一般文件\n        if (ext && !RegExp('\\\\w\\\\.(' + ext + ')$', 'i').test(escape(val))) {\n          layer.msg('不支持该文件格式', msgConf);\n          return input.value = '';\n        }\n        break;\n      case 'video':\n        //视频文件\n        if (!RegExp('\\\\w\\\\.(' + (ext || 'avi|mp4|wma|rmvb|rm|flash|3gp|flv') + ')$', 'i').test(escape(val))) {\n          layer.msg('不支持该视频格式', msgConf);\n          return input.value = '';\n        }\n        break;\n      case 'audio':\n        //音频文件\n        if (!RegExp('\\\\w\\\\.(' + (ext || 'mp3|wav|mid') + ')$', 'i').test(escape(val))) {\n          layer.msg('不支持该音频格式', msgConf);\n          return input.value = '';\n        }\n        break;\n      default:\n        //图片文件\n        if (!RegExp('\\\\w\\\\.(' + (ext || 'jpg|png|gif|bmp|jpeg') + ')$', 'i').test(escape(val))) {\n          layer.msg('不支持该图片格式', msgConf);\n          return input.value = '';\n        }\n        break;\n    }\n\n    options.before && options.before(input);\n    item.parent().submit();\n\n    var iframe = $('#' + elemIframe),\n        timer = setInterval(function () {\n      var res;\n      try {\n        res = iframe.contents().find('body').text();\n      } catch (e) {\n        layer.msg('上传接口存在跨域', msgConf);\n        clearInterval(timer);\n      }\n      if (res) {\n        clearInterval(timer);\n        iframe.contents().find('body').html('');\n        try {\n          res = JSON.parse(res);\n        } catch (e) {\n          res = {};\n          return layer.msg('请对上传接口返回JSON字符', msgConf);\n        }\n        typeof options.success === 'function' && options.success(res, input);\n      }\n    }, 30);\n\n    input.value = '';\n  };\n\n  //暴露接口\n  exports('upload', function (options) {\n    var upload = new Upload(options = options || {});\n    upload.init();\n  });\n});\n\n//# sourceMappingURL=upload-compiled.js.map"]}