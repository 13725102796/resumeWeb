{"version":3,"sources":["upload.js"],"names":[],"mappings":"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","file":"upload-compiled.js","sourcesContent":["/*!\n\n @Title: layui.upload 单文件上传 - 全浏览器兼容版\n @Author: 贤心\n @License：LGPL\n\n */\n \nlayui.define('layer', function(exports){\n  \"use strict\";\n  \n  var $ = layui.jquery;\n  var layer = layui.layer;\n  var device = layui.device();\n  \n  var elemDragEnter = 'layui-upload-enter';\n  var elemIframe = 'layui-upload-iframe';\n \n  var msgConf = {\n    icon: 2\n    ,shift: 6\n  }, fileType = {\n    file: '文件'\n    ,video: '视频'\n    ,audio: '音频'\n  };\n  \n  var Upload = function(options){\n    this.options = options;\n  };\n  \n  //初始化渲染\n  Upload.prototype.init = function(){\n    var that = this, options = that.options;\n    var body = $('body'), elem = $(options.elem || '.layui-upload-file');\n    var iframe = $('<iframe id=\"'+ elemIframe +'\" class=\"'+ elemIframe +'\" name=\"'+ elemIframe +'\"></iframe>');\n    \n    //插入iframe    \n    $('#'+elemIframe)[0] || body.append(iframe);\n    \n    return elem.each(function(index, item){\n      item = $(item);\n      var form = '<form target=\"'+ elemIframe +'\" method=\"'+ (options.method||'post') +'\" key=\"set-mine\" enctype=\"multipart/form-data\" action=\"'+ (options.url||'') +'\"></form>';\n      \n      var type = item.attr('lay-type') || options.type; //获取文件类型\n\n      //包裹ui元素\n      if(!options.unwrap){\n        form = '<div class=\"layui-box layui-upload-button\">' + form + '<span class=\"layui-upload-icon\"><i class=\"layui-icon\">&#xe608;</i>'+ (\n          item.attr('lay-title') || options.title|| ('上传'+ (fileType[type]||'图片') )\n        ) +'</span></div>';\n      }\n      \n      form = $(form);\n      \n      //拖拽支持\n      if(!options.unwrap){\n        form.on('dragover', function(e){\n          e.preventDefault();\n          $(this).addClass(elemDragEnter);\n        }).on('dragleave', function(){\n          $(this).removeClass(elemDragEnter);\n        }).on('drop', function(){\n          $(this).removeClass(elemDragEnter);\n        });\n      }\n      \n      //如果已经实例化，则移除包裹元素\n      if(item.parent('form').attr('target') === elemIframe){\n        if(options.unwrap){\n          item.unwrap();\n        } else {\n          item.parent().next().remove();\n          item.unwrap().unwrap();\n        }\n      };\n      \n      //包裹元素\n      item.wrap(form);\n      \n      //触发上传\n      item.off('change').on('change', function(){\n        that.action(this, type);\n      });\n    });\n  };\n  \n  //提交上传\n  Upload.prototype.action = function(input, type){\n    var that = this, options = that.options, val = input.value;\n    var item = $(input), ext = item.attr('lay-ext') || options.ext || ''; //获取支持上传的文件扩展名;\n\n    if(!val){\n      return;\n    };\n    \n    //校验文件\n    switch(type){\n      case 'file': //一般文件\n        if(ext && !RegExp('\\\\w\\\\.('+ ext +')$', 'i').test(escape(val))){\n          layer.msg('不支持该文件格式', msgConf);\n          return input.value = '';\n        }\n      break;\n      case 'video': //视频文件\n        if(!RegExp('\\\\w\\\\.('+ (ext||'avi|mp4|wma|rmvb|rm|flash|3gp|flv') +')$', 'i').test(escape(val))){\n          layer.msg('不支持该视频格式', msgConf);\n          return input.value = '';\n        }\n      break;\n      case 'audio': //音频文件\n        if(!RegExp('\\\\w\\\\.('+ (ext||'mp3|wav|mid') +')$', 'i').test(escape(val))){\n          layer.msg('不支持该音频格式', msgConf);\n          return input.value = '';\n        }\n      break;\n      default: //图片文件\n        if(!RegExp('\\\\w\\\\.('+ (ext||'jpg|png|gif|bmp|jpeg') +')$', 'i').test(escape(val))){\n          layer.msg('不支持该图片格式', msgConf);\n          return input.value = '';\n        }\n      break;\n    }\n    \n    options.before && options.before(input);\n    item.parent().submit();\n\n    var iframe = $('#'+elemIframe), timer = setInterval(function() {\n      var res;\n      try {\n        res = iframe.contents().find('body').text();\n      } catch(e) {\n        layer.msg('上传接口存在跨域', msgConf);\n        clearInterval(timer);\n      }\n      if(res){\n        clearInterval(timer);\n        iframe.contents().find('body').html('');\n        try {\n          res = JSON.parse(res);\n        } catch(e){\n          res = {};\n          return layer.msg('请对上传接口返回JSON字符', msgConf);\n        }\n        typeof options.success === 'function' && options.success(res, input);\n      }\n    }, 30); \n    \n    input.value = '';\n  };\n  \n  //暴露接口\n  exports('upload', function(options){\n    var upload = new Upload(options = options || {});\n    upload.init();\n  });\n});\n\n"]}